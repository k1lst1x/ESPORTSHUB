{% extends 'base_tournaments.html' %}
{% load static %}
{% load math_filters %}

{% block title %}{{ tournament.name }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="card bg-black text-white border-0 shadow-lg overflow-hidden" style="border-radius: 18px;">
        <!-- –ë–∞–Ω–Ω–µ—Ä —Ç—É—Ä–Ω–∏—Ä–∞ -->
        <img src="{% static 'images/banner.png' %}" alt="–ë–∞–Ω–Ω–µ—Ä —Ç—É—Ä–Ω–∏—Ä–∞" class="w-100"
             style="height: 500px; object-fit: cover; border-top-left-radius: 18px; border-top-right-radius: 18px;">

        <div class="p-5">
            <h1 class="mb-4 text-center fw-bold display-5" style="color: #FF6B6B;">üéØ {{ tournament.name }}</h1>

            <div class="row mb-5">
                <div class="col-md-6">
                    <ul class="list-unstyled fs-5">
                        <li class="mb-2">üéÆ <strong>–¢–∏–ø:</strong> {{ tournament.get_type_display }}</li>
                        <li class="mb-2">üïπÔ∏è <strong>–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞:</strong> {{ tournament.get_discipline_display }}</li>
                        <li class="mb-2">üìã <strong>–§–æ—Ä–º–∞—Ç:</strong> {{ tournament.get_format_display }}</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul class="list-unstyled fs-5">
                        <li class="mb-2">üë• <strong>–ú–∞–∫—Å. –∫–æ–º–∞–Ω–¥:</strong> {{ tournament.max_teams }}</li>
                        <li class="mb-2">üßë‚Äçü§ù‚Äçüßë <strong>–ò–≥—Ä–æ–∫–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–µ:</strong> {{ tournament.max_team_members }}</li>
                        <li class="mb-2">üí∞ <strong>–ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥:</strong> <span style="color: #FFD700;">${{ tournament.prize_pool }}</span></li>
                    </ul>
                </div>
            </div>

            <!-- üí∏ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–æ–≤ -->
            <div class="bg-dark p-4 rounded-3 border border-secondary mb-4">
                <h5 class="fw-bold mb-3" style="color: #FF8585;">üèÜ –ü—Ä–∏–∑–æ–≤—ã–µ –º–µ—Å—Ç–∞:</h5>
                {% if tournament.max_teams > 2 %}
                    <p class="mb-2">ü•á 1 –º–µ—Å—Ç–æ ‚Äî <span style="color: #FFD700;">${{ tournament.prize_pool|mul:0.5|to_int }}</span></p>
                    <p class="mb-2">ü•à 2 –º–µ—Å—Ç–æ ‚Äî <span style="color: #C0C0C0;">${{ tournament.prize_pool|mul:0.3|to_int }}</span></p>
                    <p class="mb-0">ü•â 3 –º–µ—Å—Ç–æ ‚Äî <span style="color: #CD7F32;">${{ tournament.prize_pool|mul:0.2|to_int }}</span></p>
                {% elif tournament.max_teams == 2 %}
                    <p class="mb-2">ü•á 1 –º–µ—Å—Ç–æ ‚Äî <span style="color: #FFD700;">${{ tournament.prize_pool|mul:0.6|to_int }}</span></p>
                    <p class="mb-0">ü•à 2 –º–µ—Å—Ç–æ ‚Äî <span style="color: #C0C0C0;">${{ tournament.prize_pool|mul:0.4|to_int }}</span></p>
                {% else %}
                    <p class="mb-0">ü•á –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –≤—Å—ë ‚Äî <span style="color: #FFD700;">${{ tournament.prize_pool|to_int }}</span></p>
                {% endif %}
            </div>

            <!-- ‚ÑπÔ∏è –ü—Ä–∞–≤–∏–ª–∞ -->
            <div class="bg-secondary bg-opacity-10 p-4 rounded-3 border border-secondary mb-4">
                <h5 class="fw-bold mb-3 text-white">üìò –ü—Ä–∞–≤–∏–ª–∞ —É—á–∞—Å—Ç–∏—è</h5>
                <ul class="mb-0">
                    <li>üìÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π –∫–æ–º–∞–Ω–¥—É –¥–æ –Ω–∞—á–∞–ª–∞ —Ç—É—Ä–Ω–∏—Ä–∞</li>
                    <li>‚è±Ô∏è –ë—É–¥—å –≤–æ–≤—Ä–µ–º—è –≤ Discord/–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ</li>
                    <li>‚öîÔ∏è –°–æ–±–ª—é–¥–∞–π –ø—Ä–∞–≤–∏–ª–∞ —á–µ—Å—Ç–Ω–æ–π –∏–≥—Ä—ã</li>
                    <li>üèÖ –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç –¥–µ–Ω–µ–∂–Ω—ã–µ –ø—Ä–∏–∑—ã –∏ —Ä–µ—Å–ø–µ–∫—Ç üéâ</li>
                </ul>
            </div>

            <div class="alert alert-danger text-center fw-semibold fs-5 rounded-3">
                üö® –£—Å–ø–µ–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, –ø–æ–∫–∞ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞!
            </div>

            <div class="text-center my-4">
                <a href="{% url 'create_team' %}" class="btn btn-lg px-5 py-3 fw-bold" style="background-color: #E63946; color: white; border-radius: 10px;">
                    üöÄ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
                </a>
            </div>

            <!-- –ö–æ–º–∞–Ω–¥—ã -->
            <h3 class="mt-5 mb-3 text-white border-bottom pb-2" style="border-color: #444;">üì¢ –£—á–∞—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã</h3>
            {% if tournament.teams.all %}
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    {% for team in tournament.teams.all %}
                        <div class="col">
                            <a href="{% url 'team_detail' team.pk %}" class="text-decoration-none text-white">
                                <div class="team-card bg-dark rounded-4 p-3 h-100 d-flex justify-content-between align-items-center shadow-sm"
                                     style="transition: transform 0.2s ease, box-shadow 0.2s ease;">
                                    <div class="d-flex align-items-center">
                                        {% if team.logo %}
                                            <img src="{{ team.logo.url }}" alt="–õ–æ–≥–æ—Ç–∏–ø {{ team.name }}" class="me-3 border border-light shadow"
                                                 style="width: 56px; height: 56px; object-fit: cover; border-radius: 10px;">
                                        {% else %}
                                            <!-- <div class="me-3 bg-secondary d-flex align-items-center justify-content-center rounded"
                                                 style="width: 56px; height: 56px;">
                                                <span class="fw-bold fs-6">üé≤</span>
                                            </div> -->
                                            <img src="{% static 'images/default_team_logo.png' %}" alt="–õ–æ–≥–æ—Ç–∏–ø {{ team.name }}" class="me-3 border border-light shadow"
                                                 style="width: 56px; height: 56px; object-fit: cover; border-radius: 10px;">
                                        {% endif %}
                                        <span class="fw-semibold fs-5">{{ team.name }}</span>
                                    </div>
                                    <span class="badge bg-danger px-2 py-2 fs-6">üîç –ü–æ–¥—Ä–æ–±–Ω–µ–µ</span>
                                </div>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-secondary text-center fw-semibold mt-4">
                    üò¢ –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥. –ë—É–¥—å –ø–µ—Ä–≤—ã–º!
                </div>
            {% endif %}

            <h3 class="mt-5 mb-3 text-white border-bottom pb-2">üó∫‚ÄØ–¢—É—Ä–Ω–∏—Ä–Ω–∞—è¬†—Å–µ—Ç–∫–∞</h3>

            {% if rounds %}
            <div class="bracket d-flex flex-nowrap justify-content-start overflow-auto">
            {# ‚îÄ‚îÄ —Ä–∞—É–Ω–¥—ã ‚îÄ‚îÄ #}
            {% for r_num, matches in rounds.items %}
            <div class="round d-flex flex-column position-relative">
                <h6 class="text-center text-white mb-3">Round {{ r_num }}</h6>

                {# ‚îÄ‚îÄ –º–∞—Ç—á–∏ ‚îÄ‚îÄ #}
                {% for m in matches %}
                
                <div class="match{% if m.is_finished %} finished{% endif %} bg-dark"
                    style="--i:{{ forloop.counter0 }}; --r:{{ r_num }};">
                    <div class="team {% if m.winner and m.team1 == m.winner %}winner{% endif %}">
                        {% if m.team1 and m.team1.logo %}
                            <img src="{{ m.team1.logo.url }}" alt="{{ m.team1.name }}">
                            <div class="connector"></div>
                        {% endif %}
                        <span class="name">{{ m.team1.name|default:"TBD" }}</span>
                        <span class="score">{{ m.score_team1 }}</span>
                    </div>

                    <div class="team {% if m.winner and m.team2 == m.winner %}winner{% endif %}">
                        {% if m.team2 and m.team2.logo %}
                            <img src="{{ m.team2.logo.url }}" alt="{{ m.team2.name }}">
                        {% endif %}
                        <span class="name">{{ m.team2.name|default:"TBD" }}</span>
                        <span class="score">{{ m.score_team2 }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .team-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 18px rgba(255, 255, 255, 0.15);
        background-color: #1f1f1f;
    }
</style>

<style>
/* –û–±—â–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—ã—Ö–æ–¥–∞ –∑–∞ —ç–∫—Ä–∞–Ω */
body {
    overflow-x: hidden;
}

/* –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –¥–ª—è –±–∞–Ω–Ω–µ—Ä–∞ –Ω–∞ –º–æ–±–∏–ª–∫–µ */
@media (max-width: 768px) {
    .card img {
        height: 200px !important;
    }
    .card .display-5 {
        font-size: 1.8rem;
    }
    .card .fs-5,
    .card .lead {
        font-size: 1rem;
    }
    .card .btn-lg {
        padding: 10px 20px;
        font-size: 1rem;
    }
    .card ul {
        padding-left: 1rem;
    }
}

/* –ö–æ–º–∞–Ω–¥–∞ –Ω–∞ –º–æ–±–∏–ª–∫–µ: –∞–≤—Ç–æ—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ + —Å–∂–∞—Ç—ã–π —Å—Ç–∏–ª—å */
@media (max-width: 576px) {
    .team-card {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 10px;
    }
    .team-card .badge {
        align-self: flex-end;
        font-size: 0.8rem;
    }
    .team-card img,
    .team-card div[style*="width: 56px"] {
        width: 48px !important;
        height: 48px !important;
    }
    .team-card span.fw-semibold {
        font-size: 1rem;
    }
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–æ–≤ */
.card ul li {
    word-break: break-word;
}

/* –ü—Ä–∏–∑–æ–≤—ã–µ –±–ª–æ–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ */
.card .bg-dark,
.card .bg-secondary {
    font-size: 0.95rem;
}

/* –°–Ω–∏–∂–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –Ω–∞ –º–æ–±–∏–ª–∫–µ */
@media (max-width: 576px) {
    .card .p-5 {
        padding: 1.5rem 1rem !important;
    }
    .card .mb-5 {
        margin-bottom: 2rem !important;
    }
}

/* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä‚Äë–∫–æ–ª–æ–Ω–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞ */
.round            {min-width:220px; margin-right:48px;}
.round:last-child {margin-right:0;}

.match{
    --line-x: 220px;             /* —à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∞ –º–∞—Ç—á–∞ (== min-width .round) */
    position: relative;
    background:#f8f9fa;
    border:1px solid #d1d1d1;
    border-radius:4px;
    margin-bottom:48px;          /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –º–∞—Ç—á–∞–º–∏ */
    min-height:72px;
    min-width:180px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    font-size:14px;
}

/* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è¬†‚Üí —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É */
.match::after{
    content:"";
    position:absolute;
    right:-24px;                 /* –¥–ª–∏–Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
    top:50%; transform:translateY(-50%);
    width:24px;
    height:2px;
    background:#a0a0a0;
}
/* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å–æ–µ–¥–∏–Ω—è—é—â–∞—è */
.match:nth-child(odd)::before{
    content:"";
    position:absolute;
    right:-24px;
    top:-120%;
    width:2px;
    height:calc(100% + 48px);     /* 24px == margin-bottom/2 */
    background:#a0a0a0;
}
/* —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ª–∏–Ω–∏–∏ —É¬†–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞—É–Ω–¥–∞ */
.round:last-child .match::after,
.round:last-child .match::before{display:none;}

.team{
    padding:4px 8px;
    display:flex; align-items:center;
    justify-content:space-between;
}
.team img{width:20px;height:20px;object-fit:contain;margin-right:6px;}
.team.winner .name,
.team.winner .score{font-weight:700;}
.finished .team:not(.winner){opacity:.55;}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞—É–Ω–¥–∞: –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
.round {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    min-width: 220px;
    margin-right: 48px;
}

/* –í—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É —É –º–∞—Ç—á–µ–π, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞—É–Ω–¥–∞ */
.round:nth-child(2) .match { margin-top: 90px; }
.round:nth-child(3) .match { margin-top: 120px; }
.round:nth-child(4) .match { margin-top: 240px; }
/* –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π –ø–æ —Ñ–æ—Ä–º—É–ª–µ 60 * 2^(n-2) */

/* –ë–ª–æ–∫ –º–∞—Ç—á–∞ —É–ª—É—á—à–µ–Ω–Ω—ã–π */
.match {
    position: relative;
    background: #222; /* —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω */
    color: #fff;
    border: 2px solid #444;
    border-radius: 8px;
    margin-bottom: 48px;
    min-height: 80px;
    min-width: 250px;
    padding: 8px 12px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    transition: box-shadow 0.2s ease;
}
.match:hover {
    box-shadow: 0 0 12px rgba(255, 255, 255, 0.1);
}

/* –£—á–∞—Å—Ç–Ω–∏–∫ */
.team {
    padding: 4px 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-radius: 4px;
}
.team img {
    width: 24px;
    height: 24px;
    object-fit: contain;
    margin-right: 8px;
}
.team .score {
    background: #000;
    color: #E63946;
    border: 1px solid #E63946;
    padding: 2px 6px;
    border-radius: 6px;
    font-weight: 600;
    min-width: 30px;
    text-align: center;
}
.team.winner .score,
.team.winner .name {
    color: #00FFAA;
    font-weight: 700;
}
.finished .team:not(.winner) {
    opacity: 0.4;
}

/* –õ–∏–Ω–∏–∏ –º–µ–∂–¥—É –º–∞—Ç—á–∞–º–∏ */
.match::after {
    content: "";
    position: absolute;
    right: -24px;
    top: 50%;
    transform: translateY(-50%);
    width: 24px;
    height: 2px;
    background: #666;
}
.match:nth-child(odd)::before {
    content: "";
    position: absolute;
    right: -24px;
    top: -109%;
    width: 2px;
    height: calc(100% + 53px);
    background: #666;
}

/* –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ª–∏–Ω–∏–∏ —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞—É–Ω–¥–∞ */
.round:last-child .match::after,
.round:last-child .match::before {
    display: none;
}

/* –í—Ö–æ–¥—è—â–∞—è —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è */
.connector {
    position: absolute;
    width: 26px;
    height: 2px;
    background: #888;
    left: -28px;
    top: 50%;
    transform: translateY(-50%);
}

/* –°–∫—Ä—ã–≤–∞–µ–º —Ç—É—Ä–Ω–∏—Ä–Ω—É—é —Å–µ—Ç–∫—É –Ω–∞ –º–æ–±–∏–ª–∫–µ */
@media (max-width: 768px) {
  .bracket {
    display: none !important;
  }
}

</style>

{% endblock %}
